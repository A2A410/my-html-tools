name: Auto Release on Commit

on:
  push:
    branches:
      - main  # change if your default branch is different

jobs:
  release:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Get latest release version
        id: get_version
        run: |
          latest_tag=$(git describe --tags --abbrev=0 2>/dev/null || echo "0")
          echo "Latest tag: $latest_tag"
          if [ "$latest_tag" = "0" ]; then
            new_version="1"
          else
            new_version=$((latest_tag + 1))
          fi
          echo "New version: $new_version"
          echo "new_version=$new_version" >> $GITHUB_OUTPUT

      - name: Create GitHub Release
        uses: ncipollo/release-action@v1
        with:
          tag: ${{ steps.get_version.outputs.new_version }}
          name: Release ${{ steps.get_version.outputs.new_version }}
          body: "Automated release for commit ${{ github.sha }}"
          draft: false
          prerelease: false
