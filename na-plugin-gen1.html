<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>NA Plugin Generator</title>
<style>
body{font-family:Arial;padding:10px;background:#111;color:#eee}
input,textarea{width:100%;padding:6px;margin:6px 0;background:#222;color:#eee;border:1px solid #444}
button{padding:8px 12px;background:#444;color:#fff;border:0;margin:6px 4px 6px 0}
.box{border:1px solid #333;padding:10px;margin:10px 0;background:#181818}
</style>
</head>
<body>

<h2>NA Plugin Generator (Simple)</h2>

<div id="cmdContainer"></div>
<button onclick="addCommandBlock()">Add Command</button>

<h3>Output</h3>
<textarea id="output" rows="15" readonly></textarea><br>

<button onclick="copyOutput()">Copy</button>
<button onclick="downloadFile()">Download .na</button>

<script>
function addCommandBlock(){
    const box=document.createElement("div");
    box.className="box";
    box.innerHTML=`
        <b>Command + Aliases (one per line, no spaces):</b>
        <textarea class="aliases" rows="3" placeholder="cmd1\nalias1\nalias2"></textarea>

        <b>Info:</b>
        <input class="info" placeholder="description">

        <b>Place IDs (pid1, pid2, pid3...):</b>
        <input class="pids" placeholder="123456, 98765">

        <b>Run Commands (one per line):</b>
        <textarea class="runcmd" rows="4" placeholder="fly 50\nfullbright"></textarea>

        <button onclick="generate()">Update Output</button>
    `;
    document.getElementById("cmdContainer").appendChild(box);
}

function sanitizeAliases(lines){
    return lines.filter(x=>{
        return x.length>0 && /^[A-Za-z0-9_]+$/.test(x)
    });
}

function generate(){
    const blocks=[];
    const boxes=document.querySelectorAll(".box");

    boxes.forEach(box=>{
        const aliases=sanitizeAliases(
            box.querySelector(".aliases").value.split("\n").map(x=>x.trim())
        );
        if(aliases.length===0) return;

        const info=box.querySelector(".info").value.trim();
        const pidraw=box.querySelector(".pids").value.trim();

        // place id logic
        let pidcode="";
        if(pidraw.length>0){
            const nums=pidraw.split(",").map(x=>x.trim()).filter(x=>/^\d+$/.test(x));
            if(nums.length>0){
                pidcode=`local allowed={${nums.join(",")}}
            if not table.find(allowed,game.PlaceId) then return end
            `;
            }
        }

        // runcommand lines
        const runcmdLines=box.querySelector(".runcmd").value.split("\n").map(x=>x.trim()).filter(x=>x.length>0);
        let exec="";
        runcmdLines.forEach(line=>{
            exec+=`runCommand("${line}")\n            `;
        });

        const block=`{
        Aliases = {${aliases.map(x=>`"${x}"`).join(",")}},
        Info = "${info}",
        Function = function()
            ${pidcode}${exec}
        end,
        RequiresArguments = false
    }`;

        blocks.push(block);
    });

    document.getElementById("output").value =
`cmdPluginAdd = {
${blocks.join(",\n")}
}`;
}

function copyOutput(){
    const o=document.getElementById("output");
    o.select();
    document.execCommand("copy");
}

// download file
function downloadFile(){
    const content=document.getElementById("output").value;
    const blob=new Blob([content],{type:"text/plain"});
    const a=document.createElement("a");

    // default filename
    a.download="plugin.na";
    a.href=URL.createObjectURL(blob);
    a.click();
}
</script>

</body>
</html>
