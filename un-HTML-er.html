<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Un-HTMLer v2</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{font-family:'Roboto',sans-serif;background:#121212;color:#e0e0e0;overflow:hidden;height:100vh;touch-action:pan-y}
.container{display:flex;flex-direction:column;height:100vh;max-width:100vw}
.header{background:#1e1e1e;padding:12px 16px;box-shadow:0 2px 4px rgba(0,0,0,.3);display:flex;align-items:center;justify-content:space-between;flex-shrink:0}
.title{font-size:18px;font-weight:500;color:#bb86fc}
.btn-group{display:flex;gap:8px}
.btn{padding:8px 16px;background:#bb86fc;color:#000;border:none;border-radius:4px;font-size:13px;font-weight:500;cursor:pointer;transition:background .2s;white-space:nowrap}
.btn:active{background:#9d6fd8}
.btn-secondary{background:#03dac6;color:#000}
.btn-secondary:active{background:#02b9a8}
.btn-danger{background:#cf6679;color:#000}
.btn-danger:active{background:#b85565}
.content{flex:1;overflow-y:auto;padding:16px;-webkit-overflow-scrolling:touch}
.upload-zone{border:2px dashed #bb86fc;border-radius:8px;padding:32px 16px;text-align:center;background:#1e1e1e;margin-bottom:16px;cursor:pointer;transition:all .2s}
.upload-zone:active{background:#2a2a2a;border-color:#9d6fd8}
.upload-zone input{display:none}
.icon{font-size:48px;margin-bottom:12px;color:#bb86fc}
.status{margin:16px 0;padding:12px;background:#1e1e1e;border-radius:4px;font-size:14px}
.preview{background:#1e1e1e;border-radius:4px;padding:16px;margin-top:16px;max-height:300px;overflow-y:auto;-webkit-overflow-scrolling:touch}
.preview pre{white-space:pre-wrap;word-wrap:break-word;font-size:13px;font-family:monospace;color:#03dac6}
.settings{position:fixed;top:0;right:-100%;width:280px;height:100vh;background:#1e1e1e;box-shadow:-2px 0 8px rgba(0,0,0,.5);transition:right .3s;z-index:1000;overflow-y:auto;-webkit-overflow-scrolling:touch}
.settings.open{right:0}
.settings-header{padding:16px;background:#2a2a2a;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:1}
.settings-content{padding:16px}
.setting-item{margin-bottom:20px}
.setting-label{display:block;margin-bottom:8px;font-size:14px;color:#bb86fc}
.changelog{background:#1e1e1e;border-radius:4px;padding:16px;margin-top:16px;font-size:13px}
.changelog h3{color:#bb86fc;margin-bottom:12px}
.changelog ul{padding-left:20px}
.changelog li{margin-bottom:8px}
.debug-panel{background:#000;border-radius:4px;padding:12px;margin-top:16px;max-height:200px;overflow-y:auto;font-family:monospace;font-size:11px;color:#03dac6;-webkit-overflow-scrolling:touch}
.debug-entry{margin-bottom:4px;padding:4px;border-bottom:1px solid #333}
.hidden{display:none}
.gear-icon{cursor:pointer;font-size:24px;color:#bb86fc;user-select:none}
</style>
</head>
<body>
<div class="container">
<div class="header">
<div class="title">Un-HTMLer v2</div>
<div class="btn-group">
<span class="gear-icon" onclick="toggleSettings()">‚öôÔ∏è</span>
</div>
</div>
<div class="content">
<div class="upload-zone" onclick="document.getElementById('fileInput').click()">
<input type="file" id="fileInput" accept=".html,.htm" multiple>
<div class="icon">üìÑ</div>
<div>Tap to select HTML files</div>
<div style="font-size:12px;color:#888;margin-top:8px">Supports .html, .htm</div>
</div>
<div class="status" id="status">Ready to process files</div>
<div class="btn-group" style="justify-content:center;margin-bottom:16px">
<button class="btn btn-secondary" onclick="loadFromStorage()">üìÇ Load</button>
<button class="btn btn-secondary" onclick="saveToStorage()">üíæ Save</button>
<button class="btn btn-danger" onclick="clearAll()">üóëÔ∏è Clear</button>
<button class="btn" onclick="location.reload()">üîÑ Refresh</button>
</div>
<div id="preview" class="preview hidden">
<pre id="previewText"></pre>
</div>
<div class="changelog">
<h3>üìã Changelog v2</h3>
<ul>
<li>‚ú® NEW: Strips JavaScript (script tags)</li>
<li>‚ú® NEW: Strips CSS (style tags)</li>
<li>Initial release - HTML tag stripping</li>
<li>Preserves text structure (line breaks, spaces)</li>
<li>Mobile-optimized interface</li>
<li>Local storage save/load</li>
<li>Debug view support</li>
<li>Multi-file processing</li>
</ul>
</div>
<div id="debugPanel" class="debug-panel hidden"></div>
</div>
</div>

<div class="settings" id="settings">
<div class="settings-header">
<div style="color:#bb86fc;font-weight:500">Settings</div>
<span style="cursor:pointer;font-size:24px" onclick="toggleSettings()">‚úï</span>
</div>
<div class="settings-content">
<div class="setting-item">
<label class="setting-label">
<input type="checkbox" id="debugMode" onchange="toggleDebug()"> Debug View
</label>
</div>
<div class="setting-item">
<label class="setting-label">
<input type="checkbox" id="preserveSpacing" checked> Preserve Extra Spacing
</label>
</div>
<div class="setting-item">
<label class="setting-label">
<input type="checkbox" id="autoDownload" checked> Auto Download
</label>
</div>
</div>
</div>

<script>
let processedFiles=[];

function log(msg){
const panel=document.getElementById('debugPanel');
if(!panel.classList.contains('hidden')){
const entry=document.createElement('div');
entry.className='debug-entry';
entry.textContent=`[${new Date().toLocaleTimeString()}] ${msg}`;
panel.appendChild(entry);
panel.scrollTop=panel.scrollHeight;
}
console.log(msg);
}

function toggleSettings(){
document.getElementById('settings').classList.toggle('open');
log('Settings toggled');
}

function toggleDebug(){
const debugPanel=document.getElementById('debugPanel');
const isChecked=document.getElementById('debugMode').checked;
debugPanel.classList.toggle('hidden',!isChecked);
log(`Debug mode ${isChecked?'enabled':'disabled'}`);
}

function updateStatus(msg){
document.getElementById('status').textContent=msg;
log(msg);
}

function stripHTML(html){
log('Starting HTML strip process');
const preserveSpacing=document.getElementById('preserveSpacing').checked;
let text=html;

// Remove script tags and content
text=text.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,'');
log('Removed <script> tags');

// Remove style tags and content
text=text.replace(/<style\b[^<]*(?:(?!<\/style>)<[^<]*)*<\/style>/gi,'');
log('Removed <style> tags');

// Replace br tags with newlines
text=text.replace(/<br\s*\/?>/gi,'\n');
text=text.replace(/<\/p>/gi,'\n\n');
text=text.replace(/<\/div>/gi,'\n');
text=text.replace(/<\/h[1-6]>/gi,'\n\n');
text=text.replace(/<\/li>/gi,'\n');
text=text.replace(/<\/tr>/gi,'\n');
text=text.replace(/<\/td>/gi,'\t');

// Remove all HTML tags
text=text.replace(/<[^>]+>/g,'');

// Decode HTML entities
const textarea=document.createElement('textarea');
textarea.innerHTML=text;
text=textarea.value;

if(!preserveSpacing){
// Clean up excessive whitespace
text=text.replace(/\n{3,}/g,'\n\n');
text=text.replace(/[ \t]{2,}/g,' ');
}

text=text.trim();
log(`Stripped HTML+JS+CSS: ${html.length} chars -> ${text.length} chars`);
return text;
}

function processFile(file){
log(`Processing file: ${file.name}`);
return new Promise((resolve,reject)=>{
const reader=new FileReader();
reader.onload=e=>{
try{
const html=e.target.result;
const text=stripHTML(html);
const result={
name:file.name.replace(/\.html?$/i,'.txt'),
content:text,
originalSize:html.length,
newSize:text.length
};
log(`File processed: ${result.name}`);
resolve(result);
}catch(err){
log(`Error processing ${file.name}: ${err.message}`);
reject(err);
}
};
reader.onerror=()=>{
log(`Error reading ${file.name}`);
reject(new Error('File read error'));
};
reader.readAsText(file);
});
}

function downloadFile(filename,content){
log(`Downloading: ${filename}`);
const blob=new Blob([content],{type:'text/plain'});
const url=URL.createObjectURL(blob);
const a=document.createElement('a');
a.href=url;
a.download=filename;
document.body.appendChild(a);
a.click();
document.body.removeChild(a);
URL.revokeObjectURL(url);
log(`Download initiated: ${filename}`);
}

function showPreview(text){
const preview=document.getElementById('preview');
const previewText=document.getElementById('previewText');
previewText.textContent=text.substring(0,1000)+(text.length>1000?'\n\n... (truncated)':'');
preview.classList.remove('hidden');
log('Preview updated');
}

document.getElementById('fileInput').addEventListener('change',async e=>{
const files=Array.from(e.target.files);
if(files.length===0)return;

log(`Selected ${files.length} file(s)`);
updateStatus(`Processing ${files.length} file(s)...`);
processedFiles=[];

try{
for(let i=0;i<files.length;i++){
const result=await processFile(files[i]);
processedFiles.push(result);
updateStatus(`Processed ${i+1}/${files.length}: ${result.name}`);
}

if(document.getElementById('autoDownload').checked){
processedFiles.forEach(f=>downloadFile(f.name,f.content));
}

if(processedFiles.length===1){
showPreview(processedFiles[0].content);
}

const totalReduction=processedFiles.reduce((sum,f)=>sum+(f.originalSize-f.newSize),0);
updateStatus(`‚úì Processed ${processedFiles.length} file(s). Reduced by ${totalReduction} chars`);
}catch(err){
updateStatus(`‚úó Error: ${err.message}`);
}

e.target.value='';
});

function saveToStorage(){
if(processedFiles.length===0){
updateStatus('Nothing to save');
return;
}
localStorage.setItem('unHtmlerData',JSON.stringify(processedFiles));
localStorage.setItem('unHtmlerTimestamp',new Date().toISOString());
updateStatus(`‚úì Saved ${processedFiles.length} file(s) to storage`);
log('Data saved to localStorage');
}

function loadFromStorage(){
const data=localStorage.getItem('unHtmlerData');
if(!data){
updateStatus('No saved data found');
return;
}
processedFiles=JSON.parse(data);
const timestamp=localStorage.getItem('unHtmlerTimestamp');
updateStatus(`‚úì Loaded ${processedFiles.length} file(s) from ${new Date(timestamp).toLocaleString()}`);
if(processedFiles.length===1){
showPreview(processedFiles[0].content);
}
log('Data loaded from localStorage');
}

function clearAll(){
processedFiles=[];
document.getElementById('preview').classList.add('hidden');
localStorage.removeItem('unHtmlerData');
localStorage.removeItem('unHtmlerTimestamp');
updateStatus('Cleared all data');
log('All data cleared');
}

log('Un-HTMLer initialized');
</script>
</body>
</html>