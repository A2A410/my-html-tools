<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<title>App Launcher</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{font-family:'Roboto',sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;overflow-x:hidden;color:#333;touch-action:pan-y}
.container{min-height:100vh;display:flex;flex-direction:column}
.header{background:rgba(255,255,255,.15);backdrop-filter:blur(10px);color:#fff;padding:16px;position:sticky;top:0;z-index:100;box-shadow:0 2px 8px rgba(0,0,0,.1)}
.header-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.header-title{font-size:20px;font-weight:700;display:flex;align-items:center;gap:8px}
.badge{background:#ff9800;color:#fff;font-size:10px;padding:3px 6px;border-radius:4px;font-weight:700}
.header-actions{display:flex;gap:8px}
.icon-btn{width:36px;height:36px;border-radius:50%;background:rgba(255,255,255,.2);border:none;color:#fff;font-size:18px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s}
.icon-btn:active{transform:scale(.9);background:rgba(255,255,255,.3)}
.icon-btn.active{background:#fff;color:#667eea}
.status{font-size:12px;opacity:.9}
.content{flex:1;padding:16px;overflow-y:auto}
.app-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-bottom:16px}
.app-item{display:flex;flex-direction:column;align-items:center;gap:8px;cursor:pointer;padding:12px;border-radius:12px;transition:all .2s;position:relative}
.app-item:active{transform:scale(.95);background:rgba(255,255,255,.1)}
.app-icon{width:56px;height:56px;border-radius:16px;display:flex;align-items:center;justify-content:center;font-size:28px;box-shadow:0 4px 12px rgba(0,0,0,.2);transition:all .2s;position:relative}
.app-name{font-size:12px;font-weight:500;text-align:center;color:#fff;max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;text-shadow:0 1px 2px rgba(0,0,0,.3)}
.app-badge{position:absolute;top:-4px;right:-4px;width:20px;height:20px;background:#f44336;color:#fff;border-radius:50%;font-size:10px;font-weight:700;display:flex;align-items:center;justify-content:center;border:2px solid #667eea}
.section-title{color:#fff;font-size:14px;font-weight:700;margin:20px 0 12px;display:flex;align-items:center;gap:8px;text-shadow:0 1px 2px rgba(0,0,0,.3)}
.empty{text-align:center;padding:60px 20px;color:rgba(255,255,255,.7);font-size:14px}
.loading{display:none;justify-content:center;padding:60px}
.spinner{width:40px;height:40px;border:4px solid rgba(255,255,255,.3);border-top:4px solid #fff;border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
.modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,.7);align-items:center;justify-content:center;padding:16px}
.modal-content{background:#fff;border-radius:16px;max-width:400px;width:100%;max-height:80vh;overflow-y:auto;box-shadow:0 8px 32px rgba(0,0,0,.3)}
.modal-header{padding:20px;border-bottom:1px solid #eee;font-size:18px;font-weight:700;color:#667eea;display:flex;align-items:center;justify-content:space-between}
.modal-body{padding:20px}
.form-group{margin-bottom:16px}
.form-label{display:block;font-size:13px;font-weight:700;color:#666;margin-bottom:6px}
.form-input{width:100%;padding:10px;border:2px solid #e0e0e0;border-radius:8px;font-size:14px;transition:all .2s}
.form-input:focus{outline:none;border-color:#667eea}
.icon-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:8px}
.icon-option{width:100%;aspect-ratio:1;border-radius:8px;border:2px solid transparent;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:24px;transition:all .2s}
.icon-option:active{transform:scale(.9)}
.icon-option.selected{border-color:#667eea;background:rgba(102,126,234,.1)}
.shape-option{border-radius:8px}
.shape-option.circle{border-radius:50%}
.shape-option.rounded{border-radius:12px}
.modal-actions{padding:16px;border-top:1px solid #eee;display:flex;gap:8px}
.btn{flex:1;padding:12px;border:none;border-radius:8px;font-size:14px;font-weight:700;cursor:pointer;transition:all .2s}
.btn-primary{background:#667eea;color:#fff}
.btn-primary:active{transform:scale(.98);background:#5568d3}
.btn-secondary{background:#e0e0e0;color:#666}
.btn-secondary:active{transform:scale(.98);background:#d0d0d0}
.btn-danger{background:#f44336;color:#fff}
.btn-danger:active{transform:scale(.98);background:#da190b}
.settings-panel{background:rgba(255,255,255,.95);border-radius:12px;padding:16px;margin-bottom:16px}
.settings-row{display:flex;align-items:center;justify-content:space-between;padding:12px 0;border-bottom:1px solid #eee}
.settings-row:last-child{border-bottom:none}
.settings-label{font-size:14px;font-weight:500;color:#333}
.toggle{position:relative;width:48px;height:28px;background:#ccc;border-radius:14px;cursor:pointer;transition:all .2s}
.toggle.active{background:#667eea}
.toggle-knob{position:absolute;top:2px;left:2px;width:24px;height:24px;background:#fff;border-radius:50%;transition:all .2s;box-shadow:0 2px 4px rgba(0,0,0,.2)}
.toggle.active .toggle-knob{left:22px}
.confirm-dialog{background:#fff;border-radius:16px;padding:24px;max-width:320px;text-align:center}
.confirm-title{font-size:18px;font-weight:700;color:#333;margin-bottom:8px}
.confirm-message{font-size:14px;color:#666;margin-bottom:20px;line-height:1.5}
.confirm-actions{display:flex;gap:8px}
.fab{position:fixed;bottom:20px;right:20px;width:56px;height:56px;border-radius:50%;background:#fff;color:#667eea;border:none;font-size:24px;box-shadow:0 4px 12px rgba(0,0,0,.3);cursor:pointer;z-index:99;display:flex;align-items:center;justify-content:center;transition:all .2s}
.fab:active{transform:scale(.9)}
</style>
</head>
<body>
<div class="container">
<div class="header">
<div class="header-top">
<div class="header-title">
üì± App Launcher v2
<span id="editBadge" class="badge" style="display:none">EDIT</span>
</div>
<div class="header-actions">
<button class="icon-btn" id="sortBtn" onclick="toggleSort()" title="Sort">‚áÖ</button>
<button class="icon-btn" id="settingsBtn" onclick="toggleSettings()" title="Settings">‚öôÔ∏è</button>
<button class="icon-btn" onclick="refresh()" title="Refresh">üîÑ</button>
</div>
</div>
<div class="status" id="status">Initializing...</div>
</div>

<div class="content" id="content">
<div class="loading" id="loading"><div class="spinner"></div></div>
<div class="empty" id="empty">No apps found</div>

<div id="settingsPanel" style="display:none">
<div class="settings-panel">
<div class="settings-row">
<div class="settings-label">Edit Mode</div>
<div class="toggle" id="editToggle" onclick="toggleEditMode()">
<div class="toggle-knob"></div>
</div>
</div>
<div class="settings-row">
<div class="settings-label">Sort Mode</div>
<div class="settings-label" id="sortMode" style="font-size:12px;color:#999">Repository Order</div>
</div>
</div>
</div>

<div id="appsContainer">
<div class="app-grid" id="appGrid"></div>
</div>

<div id="hiddenSection" style="display:none">
<div class="section-title">üóÇÔ∏è Hidden Apps</div>
<div class="app-grid" id="hiddenGrid"></div>
</div>
</div>
</div>

<button class="fab" id="hiddenFab" onclick="toggleHidden()" style="display:none">üëÅÔ∏è</button>

<div class="modal" id="editModal" onclick="if(event.target===this)closeEdit()">
<div class="modal-content">
<div class="modal-header">
<span>‚úèÔ∏è Edit App</span>
<button class="icon-btn" onclick="closeEdit()" style="background:#f5f5f5;color:#666">‚úï</button>
</div>
<div class="modal-body">
<div class="form-group">
<label class="form-label">App Name</label>
<input type="text" class="form-input" id="editName" placeholder="Enter app name">
</div>
<div class="form-group">
<label class="form-label">Icon Shape</label>
<div class="icon-grid">
<div class="shape-option rounded" style="background:#667eea" onclick="selectShape('rounded','#667eea')"></div>
<div class="shape-option rounded" style="background:#764ba2" onclick="selectShape('rounded','#764ba2')"></div>
<div class="shape-option rounded" style="background:#f44336" onclick="selectShape('rounded','#f44336')"></div>
<div class="shape-option rounded" style="background:#ff9800" onclick="selectShape('rounded','#ff9800')"></div>
<div class="shape-option rounded" style="background:#4caf50" onclick="selectShape('rounded','#4caf50')"></div>
<div class="shape-option rounded" style="background:#2196f3" onclick="selectShape('rounded','#2196f3')"></div>
<div class="shape-option circle" style="background:#667eea" onclick="selectShape('circle','#667eea')"></div>
<div class="shape-option circle" style="background:#764ba2" onclick="selectShape('circle','#764ba2')"></div>
<div class="shape-option circle" style="background:#f44336" onclick="selectShape('circle','#f44336')"></div>
<div class="shape-option circle" style="background:#ff9800" onclick="selectShape('circle','#ff9800')"></div>
<div class="shape-option circle" style="background:#4caf50" onclick="selectShape('circle','#4caf50')"></div>
<div class="shape-option circle" style="background:#2196f3" onclick="selectShape('circle','#2196f3')"></div>
<div class="shape-option" style="background:#667eea" onclick="selectShape('square','#667eea')"></div>
<div class="shape-option" style="background:#764ba2" onclick="selectShape('square','#764ba2')"></div>
<div class="shape-option" style="background:#f44336" onclick="selectShape('square','#f44336')"></div>
<div class="shape-option" style="background:#ff9800" onclick="selectShape('square','#ff9800')"></div>
<div class="shape-option" style="background:#4caf50" onclick="selectShape('square','#4caf50')"></div>
<div class="shape-option" style="background:#2196f3" onclick="selectShape('square','#2196f3')"></div>
</div>
</div>
<div class="form-group">
<label class="form-label">Icon Emoji</label>
<input type="text" class="form-input" id="editEmoji" placeholder="üì±" maxlength="2">
</div>
</div>
<div class="modal-actions">
<button class="btn btn-danger" onclick="hideApp()">Hide</button>
<button class="btn btn-secondary" onclick="closeEdit()">Cancel</button>
<button class="btn btn-primary" onclick="saveEdit()">Save</button>
</div>
</div>
</div>

<div class="modal" id="confirmModal" onclick="if(event.target===this)closeConfirm()">
<div class="confirm-dialog">
<div class="confirm-title">‚ö†Ô∏è Confirm</div>
<div class="confirm-message" id="confirmMessage"></div>
<div class="confirm-actions">
<button class="btn btn-secondary" onclick="closeConfirm()">Cancel</button>
<button class="btn btn-danger" id="confirmBtn">Confirm</button>
</div>
</div>
</div>

<script>
const $=(id)=>document.getElementById(id);
const LS_APPS='launcher_apps';
const LS_CUSTOM='launcher_custom';
const LS_HIDDEN='launcher_hidden';
const LS_SORT='launcher_sort';
let apps=[];
let customData={};
let hiddenApps=[];
let sortMode='repo';
let editMode=false;
let currentEditApp=null;
let selectedShape='rounded';
let selectedColor='#667eea';

function setStatus(msg){
$('status').textContent=msg;
}

function toggleSettings(){
const panel=$('settingsPanel');
const btn=$('settingsBtn');
if(panel.style.display==='none'){
panel.style.display='block';
btn.classList.add('active');
}else{
panel.style.display='none';
btn.classList.remove('active');
}
}

function toggleEditMode(){
editMode=!editMode;
const toggle=$('editToggle');
const badge=$('editBadge');
toggle.classList.toggle('active');
if(editMode){
badge.style.display='inline-block';
setStatus('Edit Mode ‚Ä¢ Tap apps to edit');
}else{
badge.style.display='none';
setStatus(`${apps.length} apps ‚Ä¢ Sorted by ${sortMode==='repo'?'repository order':'name'}`);
}
}

function toggleSort(){
sortMode=sortMode==='repo'?'name':'repo';
localStorage.setItem(LS_SORT,sortMode);
$('sortMode').textContent=sortMode==='repo'?'Repository Order':'Alphabetical (A-Z)';
renderApps();
setStatus(`Sorted by ${sortMode==='repo'?'repository order':'name'}`);
}

function toggleHidden(){
const section=$('hiddenSection');
section.style.display=section.style.display==='none'?'block':'none';
}

async function autoDetect(){
const hostname=window.location.hostname;
const pathname=window.location.pathname;

const isDebug=hostname==='localhost'||hostname==='127.0.0.1'||/^\d+\.\d+\.\d+\.\d+$/.test(hostname);
if(isDebug){
setStatus('‚ö†Ô∏è Debug Mode ‚Ä¢ Cannot auto-detect on localhost');
$('empty').style.display='block';
$('empty').textContent='Debug Mode: Running on localhost. Deploy to GitHub Pages to auto-detect apps.';
return;
}

const pattern=hostname.match(/^([^.]+)\.github\.io$/);
if(pattern){
const user=pattern[1];
const pathParts=pathname.split('/').filter(p=>p);
const repo=pathParts[0]||user;
await scan(user,repo);
return;
}

setStatus('‚ö†Ô∏è Not a GitHub Pages URL');
$('empty').style.display='block';
$('empty').textContent='Not served on GitHub Pages. Deploy to username.github.io to use auto-detect.';
}

async function scan(owner,repo){
$('loading').style.display='flex';
$('empty').style.display='none';
setStatus(`üîç Scanning ${owner}/${repo}...`);

try{
let apiUrl=`https://api.github.com/repos/${owner}/${repo}/git/trees/main?recursive=1`;
let res=await fetch(apiUrl);

if(!res.ok){
apiUrl=`https://api.github.com/repos/${owner}/${repo}/git/trees/master?recursive=1`;
res=await fetch(apiUrl);
if(!res.ok)throw new Error('Repository not accessible');
}

const data=await res.json();
const baseUrl=`https://${owner}.github.io/${repo}`;

apps=data.tree
.filter(f=>f.type==='blob'&&f.path.endsWith('.html'))
.map((f,i)=>({
id:f.path,
path:f.path,
name:f.path.split('/').pop().replace('.html',''),
url:`${baseUrl}/${f.path}`,
index:i
}));

localStorage.setItem(LS_APPS,JSON.stringify(apps));
loadCustomData();
renderApps();
updateHiddenFab();
setStatus(`‚úì Found ${apps.length} apps ‚Ä¢ ${owner}/${repo}`);
}catch(e){
$('empty').style.display='block';
$('empty').textContent=`Failed to scan: ${e.message}`;
setStatus('‚úó Scan failed');
}finally{
$('loading').style.display='none';
}
}

function loadCustomData(){
const stored=localStorage.getItem(LS_CUSTOM);
customData=stored?JSON.parse(stored):{};
const storedHidden=localStorage.getItem(LS_HIDDEN);
hiddenApps=storedHidden?JSON.parse(storedHidden):[];
const storedSort=localStorage.getItem(LS_SORT);
sortMode=storedSort||'repo';
$('sortMode').textContent=sortMode==='repo'?'Repository Order':'Alphabetical (A-Z)';
}

function saveCustomData(){
localStorage.setItem(LS_CUSTOM,JSON.stringify(customData));
localStorage.setItem(LS_HIDDEN,JSON.stringify(hiddenApps));
}

function getAppData(app){
const custom=customData[app.id]||{};
return{
name:custom.name||app.name,
emoji:custom.emoji||'üì±',
shape:custom.shape||'rounded',
color:custom.color||'#667eea'
};
}

function renderApps(){
const visibleApps=apps.filter(a=>!hiddenApps.includes(a.id));
let sorted=[...visibleApps];

if(sortMode==='name'){
sorted.sort((a,b)=>{
const aData=getAppData(a);
const bData=getAppData(b);
return aData.name.localeCompare(bData.name);
});
}else{
sorted.sort((a,b)=>a.index-b.index);
}

const grid=$('appGrid');
grid.innerHTML='';

if(sorted.length===0){
$('empty').style.display='block';
$('empty').textContent='All apps are hidden';
return;
}

sorted.forEach(app=>{
const data=getAppData(app);
const div=document.createElement('div');
div.className='app-item';
div.onclick=()=>handleAppClick(app);

const shapeClass=data.shape==='circle'?'border-radius:50%':data.shape==='rounded'?'border-radius:16px':'border-radius:4px';

div.innerHTML=`
<div class="app-icon" style="background:${data.color};${shapeClass}">
${data.emoji}
</div>
<div class="app-name">${data.name}</div>
`;
grid.appendChild(div);
});

renderHidden();
}

function renderHidden(){
const hiddenGrid=$('hiddenGrid');
hiddenGrid.innerHTML='';

const hidden=apps.filter(a=>hiddenApps.includes(a.id));
if(hidden.length===0){
$('hiddenSection').style.display='none';
return;
}

hidden.forEach(app=>{
const data=getAppData(app);
const div=document.createElement('div');
div.className='app-item';
div.onclick=()=>showApp(app);

const shapeClass=data.shape==='circle'?'border-radius:50%':data.shape==='rounded'?'border-radius:16px':'border-radius:4px';

div.innerHTML=`
<div class="app-icon" style="background:${data.color};${shapeClass};opacity:.6">
${data.emoji}
</div>
<div class="app-name" style="opacity:.6">${data.name}</div>
`;
hiddenGrid.appendChild(div);
});
}

function updateHiddenFab(){
$('hiddenFab').style.display=hiddenApps.length>0?'flex':'none';
}

function handleAppClick(app){
if(editMode){
openEdit(app);
}else{
window.open(app.url,'_blank','noopener,noreferrer');
}
}

function openEdit(app){
currentEditApp=app;
const data=getAppData(app);
$('editName').value=data.name;
$('editEmoji').value=data.emoji;
selectedShape=data.shape;
selectedColor=data.color;
updateShapeSelection();
$('editModal').style.display='flex';
}

function closeEdit(){
$('editModal').style.display='none';
currentEditApp=null;
}

function selectShape(shape,color){
selectedShape=shape;
selectedColor=color;
updateShapeSelection();
}

function updateShapeSelection(){
document.querySelectorAll('.shape-option').forEach(el=>{
el.classList.remove('selected');
const elShape=el.classList.contains('circle')?'circle':el.classList.contains('rounded')?'rounded':'square';
const elColor=el.style.background;
if(elShape===selectedShape&&elColor===selectedColor){
el.classList.add('selected');
}
});
}

function saveEdit(){
if(!currentEditApp)return;
const name=$('editName').value.trim()||currentEditApp.name;
const emoji=$('editEmoji').value.trim()||'üì±';
customData[currentEditApp.id]={name,emoji,shape:selectedShape,color:selectedColor};
saveCustomData();
renderApps();
closeEdit();
setStatus('‚úì App updated');
}

function hideApp(){
if(!currentEditApp)return;
$('confirmMessage').textContent=`Hide "${getAppData(currentEditApp).name}"? You can restore it from the hidden apps section.`;
$('confirmBtn').onclick=()=>{
hiddenApps.push(currentEditApp.id);
saveCustomData();
renderApps();
updateHiddenFab();
closeEdit();
closeConfirm();
setStatus('‚úì App hidden');
};
$('editModal').style.display='none';
$('confirmModal').style.display='flex';
}

function showApp(app){
$('confirmMessage').textContent=`Restore "${getAppData(app).name}"?`;
$('confirmBtn').onclick=()=>{
hiddenApps=hiddenApps.filter(id=>id!==app.id);
saveCustomData();
renderApps();
updateHiddenFab();
closeConfirm();
setStatus('‚úì App restored');
};
$('confirmModal').style.display='flex';
}

function closeConfirm(){
$('confirmModal').style.display='none';
}

async function refresh(){
setStatus('üîÑ Force scanning repository...');
await autoDetect();
}

window.onload=()=>{
const stored=localStorage.getItem(LS_APPS);
if(stored){
apps=JSON.parse(stored);
loadCustomData();
renderApps();
updateHiddenFab();
setStatus(`${apps.length} apps loaded`);
}else{
autoDetect();
}
};
</script>
</body>
</html>