<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>HTML Engine Index</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Roboto',sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:16px;color:#333}
.container{max-height:calc(100vh - 32px);background:#fff;border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,.2);overflow:hidden;display:flex;flex-direction:column}
.header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;padding:20px;box-shadow:0 2px 8px rgba(0,0,0,.1);position:sticky;top:0;z-index:100}
.header h1{font-size:24px;margin-bottom:12px;font-weight:500}
.controls{display:flex;flex-direction:column;gap:8px}
.input-group{display:flex;gap:8px}
.input-group input{flex:1;padding:10px;border:none;border-radius:6px;font-size:14px;background:rgba(255,255,255,.9)}
.btn{padding:10px 16px;border:none;border-radius:6px;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s;text-align:center;white-space:nowrap}
.btn-primary{background:#fff;color:#667eea}
.btn-primary:active{transform:scale(.95);background:#f0f0f0}
.btn-secondary{background:rgba(255,255,255,.2);color:#fff;border:1px solid rgba(255,255,255,.3)}
.btn-secondary:active{background:rgba(255,255,255,.3)}
.btn-github{background:#24292e;color:#fff;border:none}
.btn-github:active{background:#1a1e22}
.status{margin-top:8px;padding:8px;background:rgba(255,255,255,.15);border-radius:6px;font-size:13px;min-height:36px;display:flex;align-items:center}
.content{flex:1;overflow-y:auto;padding:20px}
.list-item{background:#f5f5f5;padding:14px;margin-bottom:10px;border-radius:8px;cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:12px;box-shadow:0 2px 4px rgba(0,0,0,.05)}
.list-item:active{transform:scale(.98);background:#e0e0e0}
.list-item-icon{width:40px;height:40px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border-radius:8px;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:18px;flex-shrink:0}
.list-item-text{flex:1;overflow:hidden}
.list-item-title{font-weight:500;color:#333;font-size:15px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.list-item-path{font-size:12px;color:#666;margin-top:4px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.list-item-url{font-size:11px;color:#999;margin-top:2px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.empty{text-align:center;padding:40px;color:#999;font-size:14px}
.loading{display:none;justify-content:center;padding:40px}
.spinner{width:40px;height:40px;border:4px solid #f3f3f3;border-top:4px solid #667eea;border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
.error{color:#ff6b6b;background:rgba(255,107,107,.1);padding:12px;border-radius:6px;margin:10px 0;font-size:13px}
.modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,.5);align-items:center;justify-content:center}
.modal-content{background:#fff;border-radius:12px;padding:24px;max-width:500px;margin:16px;max-height:80vh;overflow-y:auto;box-shadow:0 8px 32px rgba(0,0,0,.3)}
.modal-header{font-size:20px;font-weight:700;margin-bottom:16px;color:#667eea}
.modal-section{margin-bottom:16px;padding-bottom:16px;border-bottom:1px solid #eee}
.modal-section:last-child{border-bottom:none}
.modal-section h3{font-size:15px;font-weight:700;color:#333;margin-bottom:8px}
.modal-section p{font-size:14px;color:#666;line-height:1.6;margin-bottom:8px}
.modal-section code{background:#f5f5f5;padding:2px 6px;border-radius:4px;font-family:monospace;font-size:13px;color:#667eea}
.modal-close{background:#667eea;color:#fff;border:none;padding:10px 20px;border-radius:6px;font-size:14px;font-weight:500;cursor:pointer;width:100%;margin-top:8px}
.modal-close:active{transform:scale(.95)}
.fab-container{position:fixed;bottom:20px;right:20px;display:flex;flex-direction:column;gap:12px;z-index:99}
.fab{width:56px;height:56px;border-radius:50%;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;border:none;font-size:24px;box-shadow:0 4px 12px rgba(0,0,0,.3);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}
.fab:active{transform:scale(.9)}
.fab.secondary{background:#24292e;font-size:20px}
</style>
</head>
<body>
<div class="container">
<div class="header">
<h1>üóÇÔ∏è HTML Engine Index v2 <span id="debugBadge" style="display:none;background:#ff9800;color:#fff;font-size:11px;padding:4px 8px;border-radius:4px;font-weight:700;margin-left:8px">DEBUG</span></h1>
<div class="controls">
<div class="input-group">
<input type="text" id="repoInput" placeholder="owner/repo or leave empty for auto-detect">
<button class="btn btn-primary" onclick="scan()">Scan</button>
</div>
<div class="input-group">
<input type="text" id="baseUrlInput" placeholder="Optional: Custom base URL (e.g., https://mysite.com)">
</div>
<div class="input-group">
<button class="btn btn-secondary" onclick="autoDetect()">Auto Detect</button>
<button class="btn btn-secondary" onclick="refresh()">Refresh</button>
<button class="btn btn-secondary" onclick="clearData()">Clear</button>
<button class="btn btn-secondary" onclick="showHelp()">‚ÑπÔ∏è Help</button>
</div>
<div class="input-group">
<button class="btn btn-github" id="repoLink" onclick="openRepo()" style="display:none">üîó Open on GitHub</button>
</div>
<div class="status" id="status">Ready to scan ‚Ä¢ Detects from current URL or manual input</div>
</div>
</div>
<div class="content" id="content">
<div class="loading" id="loading"><div class="spinner"></div></div>
<div class="empty" id="empty">Enter a GitHub repo or use auto-detect to start</div>
<div id="list"></div>
</div>
</div>

<div class="fab-container">
<button class="fab secondary" onclick="showHelp()" title="Help">‚ÑπÔ∏è</button>
<button class="fab" onclick="scrollToTop()" title="Scroll to top">‚Üë</button>
</div>

<div class="modal" id="helpModal" onclick="if(event.target===this)closeHelp()">
<div class="modal-content">
<div class="modal-header">üìñ How to Use</div>

<div class="modal-section">
<h3>Auto-Detect Mode</h3>
<p>If this HTML is served on GitHub Pages, click <code>Auto Detect</code> to automatically find the repository and scan it.</p>
<p>Example: Served at <code>user.github.io/repo/</code> ‚Üí Auto-detects <code>user/repo</code></p>
</div>

<div class="modal-section">
<h3>Manual Repo Input</h3>
<p>Enter the GitHub repository in <code>owner/repo</code> format:</p>
<p><code>octocat/Hello-World</code></p>
<p>The engine will scan <code>github.com</code> and list all HTML files found in that repository.</p>
</div>

<div class="modal-section">
<h3>Custom Base URL (Advanced)</h3>
<p>If your HTML files are served from a custom domain or different path structure, enter the base URL:</p>
<p><code>https://mycustomdomain.com</code></p>
<p><code>https://subdomain.site.io/path</code></p>
<p>The engine will generate URLs as: <code>base-url/path/file.html</code></p>
<p><strong>When to use:</strong> When files are deployed to custom domains, CDNs, or alternative hosting with different URL patterns than standard GitHub Pages.</p>
</div>

<div class="modal-section">
<h3>Cross-Repo Scanning</h3>
<p><strong>NEW:</strong> Scan ANY repository and open files from their actual location.</p>
<p>Example: Hosted on <code>user1.github.io/repo1</code> ‚Üí Scan <code>user2/repo2</code> ‚Üí Files open from <code>user2.github.io/repo2</code></p>
<p>URLs are now ABSOLUTE and properly route to external repos.</p>
</div>

<div class="modal-section">
<h3>Features</h3>
<p>‚Ä¢ Scans GitHub repositories recursively for all HTML files</p>
<p>‚Ä¢ Caches results in localStorage for quick reload</p>
<p>‚Ä¢ Works in debug mode on localhost for testing</p>
<p>‚Ä¢ Generates proper ABSOLUTE URLs for deployed pages</p>
<p>‚Ä¢ Click any file to open in new tab (external repos work correctly)</p>
</div>

<button class="modal-close" onclick="closeHelp()">Got it!</button>
</div>
</div>

<script>
const $=(id)=>document.getElementById(id);
const LS_KEY='engine_index_data';
const LS_REPO='engine_index_repo';
const LS_BASE='engine_index_base';
let currentRepo='';

function showHelp(){
$('helpModal').style.display='flex';
}
function closeHelp(){
$('helpModal').style.display='none';
}

function scrollToTop(){
$('content').scrollTo({top:0,behavior:'smooth'});
}

function openRepo(){
if(currentRepo){
window.open(`https://github.com/${currentRepo}`,'_blank');
}
}

function autoDetect(){
const hostname=window.location.hostname;
const pathname=window.location.pathname;

const isDebug=hostname==='localhost'||hostname==='127.0.0.1'||/^\d+\.\d+\.\d+\.\d+$/.test(hostname)||hostname.startsWith('192.168.')||hostname.startsWith('10.');
if(isDebug){
showDebugMode();
return;
}

const pattern=hostname.match(/^([^.]+)\.github\.io$/);
if(pattern){
const user=pattern[1];
const pathParts=pathname.split('/').filter(p=>p);
const repo=pathParts[0]||user;
$('repoInput').value=`${user}/${repo}`;
const baseUrl=pathParts.length>0&&pathParts[0]===repo?`https://${hostname}/${repo}`:`https://${hostname}`;
localStorage.setItem(LS_BASE,baseUrl);
setStatus(`Auto-detected from URL ‚Üí Will scan github.com/${user}/${repo}`,'success');
scan();
return;
}

setStatus(`Not a GitHub Pages URL ‚Ä¢ Enter repo manually`,'error');
}

function showDebugMode(){
$('debugBadge').style.display='inline-block';
const info={
protocol:window.location.protocol,
hostname:window.location.hostname,
port:window.location.port,
pathname:window.location.pathname,
href:window.location.href,
userAgent:navigator.userAgent.substring(0,50)+'...',
viewport:`${window.innerWidth}x${window.innerHeight}`,
storage:typeof(Storage)!=='undefined'?'‚úì Available':'‚úó Not Available',
localStorage:Object.keys(localStorage).length+' items'
};

$('empty').style.display='none';
$('list').innerHTML='';

const debugDiv=document.createElement('div');
debugDiv.style.cssText='background:#f8f9fa;padding:20px;border-radius:8px;font-family:monospace;font-size:13px;line-height:1.8';
debugDiv.innerHTML=`
<div style="background:#24292e;color:#fff;padding:12px;border-radius:6px;margin-bottom:16px;font-weight:700;text-align:center">
üîß DEBUG MODE ACTIVE
</div>
<div style="background:#fff;padding:16px;border-radius:6px;margin-bottom:12px">
<div style="color:#666;margin-bottom:8px;font-weight:700">LOCATION INFO:</div>
<div>Protocol: <span style="color:#667eea;font-weight:700">${info.protocol}</span></div>
<div>Hostname: <span style="color:#667eea;font-weight:700">${info.hostname}</span></div>
<div>Port: <span style="color:#667eea;font-weight:700">${info.port||'(default)'}</span></div>
<div>Path: <span style="color:#667eea;font-weight:700">${info.pathname}</span></div>
<div style="margin-top:8px;word-break:break-all;color:#999">${info.href}</div>
</div>
<div style="background:#fff;padding:16px;border-radius:6px;margin-bottom:12px">
<div style="color:#666;margin-bottom:8px;font-weight:700">ENVIRONMENT:</div>
<div>Viewport: <span style="color:#667eea;font-weight:700">${info.viewport}</span></div>
<div>Local Storage: <span style="color:#667eea;font-weight:700">${info.storage}</span></div>
<div>Cached Data: <span style="color:#667eea;font-weight:700">${info.localStorage}</span></div>
</div>
<div style="background:#fff;padding:16px;border-radius:6px;margin-bottom:12px">
<div style="color:#666;margin-bottom:8px;font-weight:700">USER AGENT:</div>
<div style="color:#999;font-size:11px;word-break:break-all">${info.userAgent}</div>
</div>
<div style="background:#e3f2fd;padding:12px;border-radius:6px;color:#1976d2;text-align:center">
Running on local/debug environment<br>
<strong>Enter a repo manually to scan</strong>
</div>
`;
$('list').appendChild(debugDiv);
setStatus(`üîß Debug Mode ‚Ä¢ Local environment detected (${info.hostname})`,'info');
}

function setStatus(msg,type='info'){
const s=$('status');
s.textContent=msg;
s.style.background=type==='error'?'rgba(255,107,107,.3)':type==='success'?'rgba(76,175,80,.3)':'rgba(255,255,255,.15)';
}

function save(data,repo,baseUrl){
localStorage.setItem(LS_KEY,JSON.stringify(data));
localStorage.setItem(LS_REPO,repo);
if(baseUrl)localStorage.setItem(LS_BASE,baseUrl);
}

function load(){
const data=localStorage.getItem(LS_KEY);
const repo=localStorage.getItem(LS_REPO);
const baseUrl=localStorage.getItem(LS_BASE);
if(data&&repo){
$('repoInput').value=repo;
if(baseUrl)$('baseUrlInput').value=baseUrl;
currentRepo=repo;
$('repoLink').style.display='block';
render(JSON.parse(data));
setStatus(`Loaded ${JSON.parse(data).length} files (cached) ‚Ä¢ github.com/${repo}`,'success');
return true;
}
return false;
}

function clearData(){
localStorage.removeItem(LS_KEY);
localStorage.removeItem(LS_REPO);
localStorage.removeItem(LS_BASE);
$('repoInput').value='';
$('baseUrlInput').value='';
$('list').innerHTML='';
$('empty').style.display='block';
$('repoLink').style.display='none';
currentRepo='';
setStatus('Data cleared','success');
}

function refresh(){
const repo=$('repoInput').value.trim();
if(repo)scan();
else autoDetect();
}

async function scan(){
const repo=$('repoInput').value.trim();
if(!repo){
setStatus('Please enter a repository (owner/repo)','error');
return;
}

const customBase=$('baseUrlInput').value.trim();

currentRepo=repo;
$('repoLink').style.display='block';
$('loading').style.display='flex';
$('empty').style.display='none';
$('list').innerHTML='';
setStatus(`üîç Scanning github.com/${repo}...`);

try{
const htmlFiles=await fetchRepoFiles(repo,customBase);
if(htmlFiles.length===0){
$('empty').style.display='block';
$('empty').textContent='No HTML files found in this GitHub repository';
setStatus(`github.com/${repo} ‚Ä¢ No HTML files found`,'error');
}else{
render(htmlFiles);
save(htmlFiles,repo,customBase);
setStatus(`‚úì Scanned github.com/${repo} ‚Ä¢ Found ${htmlFiles.length} HTML files`,'success');
}
}catch(e){
$('empty').style.display='block';
$('empty').innerHTML=`<div class="error">Failed to scan github.com/${repo}<br>${e.message}</div>`;
setStatus(`‚úó Error scanning github.com/${repo}`,'error');
}finally{
$('loading').style.display='none';
}
}

async function fetchRepoFiles(repo,customBase){
const [owner,repoName]=repo.split('/');
if(!owner||!repoName)throw new Error('Invalid format. Use: owner/repo');

let apiUrl=`https://api.github.com/repos/${owner}/${repoName}/git/trees/main?recursive=1`;
let res=await fetch(apiUrl);

if(!res.ok){
apiUrl=`https://api.github.com/repos/${owner}/${repoName}/git/trees/master?recursive=1`;
res=await fetch(apiUrl);
if(!res.ok)throw new Error('Repository not found or not accessible');
}

const data=await res.json();
return parseFiles(data.tree,owner,repoName,customBase);
}

function parseFiles(tree,owner,repo,customBase){
// CRITICAL FIX: Always generate ABSOLUTE URLs based on the SCANNED repo, not current location
const baseUrl=customBase||`https://${owner}.github.io/${repo}`;

return tree
.filter(f=>f.type==='blob'&&f.path.endsWith('.html'))
.map(f=>{
// Ensure URL is ABSOLUTE with proper protocol
const absUrl=baseUrl.startsWith('http')?`${baseUrl}/${f.path}`:`https://${baseUrl}/${f.path}`;
return{
path:f.path,
name:f.path.split('/').pop(),
url:absUrl,
githubUrl:`https://github.com/${owner}/${repo}/blob/main/${f.path}`
};
})
.sort((a,b)=>a.path.localeCompare(b.path));
}

function render(files){
const list=$('list');
list.innerHTML='';
files.forEach((f,i)=>{
const div=document.createElement('div');
div.className='list-item';
// CRITICAL FIX: Store URL as data attribute and use it explicitly
div.setAttribute('data-url',f.url);
div.onclick=function(e){
e.preventDefault();
e.stopPropagation();
const targetUrl=this.getAttribute('data-url');
console.log('Opening:',targetUrl); // Debug log
window.open(targetUrl,'_blank','noopener,noreferrer');
};
div.innerHTML=`
<div class="list-item-icon">${i+1}</div>
<div class="list-item-text">
<div class="list-item-title">${f.name}</div>
<div class="list-item-path">${f.path}</div>
<div class="list-item-url">${f.url}</div>
</div>
`;
list.appendChild(div);
});
$('empty').style.display='none';
}

window.onload=()=>{
if(!load()){
if(window.location.hostname.includes('.github.io')){
setTimeout(autoDetect,300);
}
}
};
</script>
</body>
</html>