<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>File Downloader</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Roboto',Arial,sans-serif;background:#121212;color:#e0e0e0;transition:background .3s,color .3s;overflow-x:hidden}
body.light{background:#f5f5f5;color:#212121}
.container{max-width:800px;margin:20px auto;padding:0 16px}
.card{background:#1e1e1e;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.3);margin-bottom:16px;overflow:hidden;transition:box-shadow .3s}
.light .card{background:#fff;box-shadow:0 2px 8px rgba(0,0,0,.1)}
.card:hover{box-shadow:0 4px 16px rgba(0,0,0,.4)}
.light .card:hover{box-shadow:0 4px 16px rgba(0,0,0,.15)}
.card-header{background:#2196f3;color:#fff;padding:16px;font-size:18px;font-weight:500;display:flex;justify-content:space-between;align-items:center;cursor:pointer;user-select:none}
.card-content{padding:16px}
.input-group{margin-bottom:16px}
label{display:block;margin-bottom:8px;font-size:14px;color:#b0b0b0}
.light label{color:#666}
input[type="text"],input[type="url"]{width:100%;padding:12px;border:1px solid #333;border-radius:4px;background:#2a2a2a;color:#e0e0e0;font-size:14px;transition:border .3s}
.light input[type="text"],.light input[type="url"]{background:#fff;border:1px solid #ccc;color:#212121}
input:focus{outline:none;border-color:#2196f3}
.btn{padding:12px 24px;border:none;border-radius:4px;font-size:14px;font-weight:500;cursor:pointer;transition:all .3s;text-transform:uppercase;letter-spacing:.5px;display:inline-block;text-decoration:none;text-align:center}
.btn-primary{background:#2196f3;color:#fff}
.btn-primary:hover{background:#1976d2;box-shadow:0 2px 8px rgba(33,150,243,.4)}
.btn-secondary{background:#424242;color:#e0e0e0}
.light .btn-secondary{background:#e0e0e0;color:#212121}
.btn-secondary:hover{background:#616161}
.light .btn-secondary:hover{background:#bdbdbd}
.btn-success{background:#4caf50;color:#fff}
.btn-success:hover{background:#388e3c}
.btn-group{display:flex;gap:8px;flex-wrap:wrap}
.progress-container{margin:16px 0;display:none}
.progress-bar{width:100%;height:8px;background:#333;border-radius:4px;overflow:hidden}
.light .progress-bar{background:#e0e0e0}
.progress-fill{height:100%;background:linear-gradient(90deg,#2196f3,#21cbf3);transition:width .3s;border-radius:4px}
.progress-text{margin-top:8px;font-size:14px;color:#b0b0b0}
.light .progress-text{color:#666}
.terminal{background:#1a1a1a;border:1px solid #333;border-radius:4px;padding:12px;font-family:'Courier New',monospace;font-size:12px;max-height:200px;overflow-y:auto;margin-top:16px;display:none;white-space:pre-wrap;word-break:break-all}
.light .terminal{background:#f9f9f9;border-color:#ccc;color:#212121}
.switch{position:relative;display:inline-block;width:48px;height:24px}
.switch input{opacity:0;width:0;height:0}
.slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:#616161;transition:.3s;border-radius:24px}
.slider:before{position:absolute;content:"";height:18px;width:18px;left:3px;bottom:3px;background:#fff;transition:.3s;border-radius:50%}
input:checked+.slider{background:#2196f3}
input:checked+.slider:before{transform:translateX(24px)}
.settings-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.download-item{background:#2a2a2a;padding:12px;border-radius:4px;margin-bottom:8px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px}
.light .download-item{background:#f5f5f5}
.download-item-name{flex:1;min-width:200px;word-break:break-all;font-size:14px}
.changelog{max-height:300px;overflow-y:auto;font-size:13px;line-height:1.6}
.changelog h4{color:#2196f3;margin:8px 0}
.debug-log{max-height:400px}
.collapsible{display:none}
.collapsible.active{display:block}
.rotate{transform:rotate(180deg);transition:transform .3s}
.icon{display:inline-block;margin-left:8px;transition:transform .3s}
@media(max-width:600px){.container{padding:0 8px}.card-header{font-size:16px;padding:12px}.card-content{padding:12px}.btn{padding:10px 16px;font-size:13px}}
</style>
</head>
<body>
<div class="container">
<div class="card">
<div class="card-header" onclick="toggleSection('main')">
File Downloader <span class="icon">▼</span>
</div>
<div id="main" class="card-content collapsible active">
<div class="input-group">
<label for="url">Enter URL:</label>
<input type="url" id="url" placeholder="https://example.com/file.zip">
</div>
<div class="input-group">
<label for="filename">Custom Filename (optional):</label>
<input type="text" id="filename" placeholder="Leave empty for auto-detect">
</div>
<div class="btn-group">
<button class="btn btn-primary" onclick="startDownload()">Download</button>
<button class="btn btn-secondary" onclick="clearAll()">Clear</button>
<button class="btn btn-success" onclick="saveState()">Save State</button>
</div>
<div class="progress-container" id="progress-container">
<div class="progress-bar">
<div class="progress-fill" id="progress-fill"></div>
</div>
<div class="progress-text" id="progress-text">0%</div>
</div>
<div class="terminal" id="terminal"></div>
</div>
</div>

<div class="card">
<div class="card-header" onclick="toggleSection('downloads')">
Download History <span class="icon">▼</span>
</div>
<div id="downloads" class="card-content collapsible">
<div id="download-list"></div>
</div>
</div>

<div class="card">
<div class="card-header" onclick="toggleSection('settings')">
Settings <span class="icon">▼</span>
</div>
<div id="settings" class="card-content collapsible">
<div class="settings-row">
<label>Dark Mode</label>
<label class="switch">
<input type="checkbox" id="theme-toggle" onchange="toggleTheme()" checked>
<span class="slider"></span>
</label>
</div>
<div class="settings-row">
<label>Show Terminal</label>
<label class="switch">
<input type="checkbox" id="terminal-toggle" onchange="toggleTerminal()">
<span class="slider"></span>
</label>
</div>
<div class="settings-row">
<label>Auto-save History</label>
<label class="switch">
<input type="checkbox" id="autosave-toggle" checked>
<span class="slider"></span>
</label>
</div>
<div class="btn-group" style="margin-top:16px">
<button class="btn btn-secondary" onclick="loadState()">Load Saved</button>
<button class="btn btn-secondary" onclick="exportHistory()">Export History</button>
</div>
</div>
</div>

<div class="card">
<div class="card-header" onclick="toggleSection('debug')">
Debug View <span class="icon">▼</span>
</div>
<div id="debug" class="card-content collapsible">
<div class="terminal debug-log" id="debug-log">No debug logs yet...</div>
<button class="btn btn-secondary" onclick="clearDebug()" style="margin-top:12px">Clear Debug</button>
</div>
</div>

<div class="card">
<div class="card-header" onclick="toggleSection('changelog')">
Changelog <span class="icon">▼</span>
</div>
<div id="changelog" class="card-content collapsible">
<div class="changelog">
<h4>v1.0 - Initial Release</h4>
<ul>
<li>Complete UI revamp with Material Design</li>
<li>Mobile-optimized touch interface</li>
<li>LocalStorage save/load functionality</li>
<li>Download history tracking</li>
<li>Progress bar with percentage display</li>
<li>Terminal view for detailed logs</li>
<li>Debug view for development</li>
<li>Auto-detect MIME types and extensions</li>
<li>Custom filename support</li>
<li>Dark/Light theme toggle</li>
<li>Collapsible sections for better organization</li>
<li>Export history feature</li>
<li>Responsive design for mobile devices</li>
</ul>
</div>
</div>
</div>
</div>

<script>
const log=(msg,type='info')=>{
const term=document.getElementById('terminal');
const debug=document.getElementById('debug-log');
const time=new Date().toLocaleTimeString();
const logMsg=`[${time}] ${type.toUpperCase()}: ${msg}\n`;
if(term.style.display!=='none'){
term.textContent+=logMsg;
term.scrollTop=term.scrollHeight;
}
if(debug.textContent==='No debug logs yet...') debug.textContent='';
debug.textContent+=logMsg;
debug.scrollTop=debug.scrollHeight;
};

const getMimeExt=(url,type)=>{
const mimeMap={
'application/pdf':'pdf','application/zip':'zip','application/x-rar':'rar',
'image/jpeg':'jpg','image/png':'png','image/gif':'gif','image/webp':'webp',
'video/mp4':'mp4','video/webm':'webm','audio/mpeg':'mp3','audio/wav':'wav',
'text/plain':'txt','text/html':'html','application/json':'json',
'application/octet-stream':'bin'
};
let ext=mimeMap[type]||'bin';
const urlExt=url.split('.').pop().split('?')[0];
if(urlExt&&urlExt.length<=4) ext=urlExt;
return ext;
};

const saveToHistory=(url,filename,size)=>{
const history=JSON.parse(localStorage.getItem('downloadHistory')||'[]');
history.unshift({url,filename,size,date:new Date().toISOString()});
if(history.length>50) history.length=50;
localStorage.setItem('downloadHistory',JSON.stringify(history));
updateHistoryDisplay();
};

const updateHistoryDisplay=()=>{
const list=document.getElementById('download-list');
const history=JSON.parse(localStorage.getItem('downloadHistory')||'[]');
if(history.length===0){
list.innerHTML='<p style="color:#666">No downloads yet</p>';
return;
}
list.innerHTML=history.map((item,i)=>`
<div class="download-item">
<div class="download-item-name">
<strong>${item.filename}</strong><br>
<small>${(item.size/1024/1024).toFixed(2)} MB - ${new Date(item.date).toLocaleString()}</small>
</div>
<button class="btn btn-secondary" onclick="redownload(${i})" style="padding:8px 12px">Re-download</button>
</div>
`).join('');
};

const redownload=(index)=>{
const history=JSON.parse(localStorage.getItem('downloadHistory')||'[]');
if(history[index]){
document.getElementById('url').value=history[index].url;
document.getElementById('filename').value=history[index].filename;
log(`Loaded from history: ${history[index].filename}`);
}
};

const startDownload=()=>{
const url=document.getElementById('url').value.trim();
const customName=document.getElementById('filename').value.trim();
if(!url){
alert('Please enter a URL');
return;
}
log(`Starting download: ${url}`);
const xhr=new XMLHttpRequest();
const progressContainer=document.getElementById('progress-container');
const progressFill=document.getElementById('progress-fill');
const progressText=document.getElementById('progress-text');
progressContainer.style.display='block';
progressFill.style.width='0%';
progressText.textContent='0%';
xhr.open('GET',url,true);
xhr.responseType='arraybuffer';
xhr.addEventListener('progress',(e)=>{
if(e.lengthComputable){
const pct=((e.loaded/e.total)*100).toFixed(2);
progressFill.style.width=pct+'%';
progressText.textContent=`${pct}% (${(e.loaded/1024/1024).toFixed(2)}/${(e.total/1024/1024).toFixed(2)} MB)`;
log(`Progress: ${pct}%`);
}
});
xhr.addEventListener('load',()=>{
if(xhr.status===200){
const contentType=xhr.getResponseHeader('Content-Type')||'application/octet-stream';
const ext=getMimeExt(url,contentType);
const filename=customName||`download_${Date.now()}.${ext}`;
const blob=new Blob([xhr.response],{type:contentType});
const link=document.createElement('a');
link.href=URL.createObjectURL(blob);
link.download=filename;
link.click();
URL.revokeObjectURL(link.href);
log(`Download complete: ${filename} (${(xhr.response.byteLength/1024/1024).toFixed(2)} MB)`,'success');
if(document.getElementById('autosave-toggle').checked){
saveToHistory(url,filename,xhr.response.byteLength);
}
progressText.textContent='Complete!';
}else{
log(`Error: HTTP ${xhr.status}`,'error');
alert(`Download failed: ${xhr.status}`);
}
});
xhr.addEventListener('error',()=>{
log('Network error occurred','error');
alert('Network error - check URL and connection');
});
xhr.send();
};

const toggleSection=(id)=>{
const section=document.getElementById(id);
const header=section.previousElementSibling;
const icon=header.querySelector('.icon');
section.classList.toggle('active');
icon.classList.toggle('rotate');
};

const toggleTheme=()=>{
document.body.classList.toggle('light');
const isDark=!document.body.classList.contains('light');
localStorage.setItem('theme',isDark?'dark':'light');
log(`Theme changed to ${isDark?'dark':'light'} mode`);
};

const toggleTerminal=()=>{
const term=document.getElementById('terminal');
term.style.display=term.style.display==='none'?'block':'none';
};

const clearAll=()=>{
document.getElementById('url').value='';
document.getElementById('filename').value='';
document.getElementById('progress-fill').style.width='0%';
document.getElementById('progress-text').textContent='0%';
document.getElementById('terminal').textContent='';
log('Cleared all fields');
};

const saveState=()=>{
const state={
url:document.getElementById('url').value,
filename:document.getElementById('filename').value,
timestamp:Date.now()
};
localStorage.setItem('downloaderState',JSON.stringify(state));
log('State saved successfully','success');
alert('Current state saved!');
};

const loadState=()=>{
const state=JSON.parse(localStorage.getItem('downloaderState')||'null');
if(state){
document.getElementById('url').value=state.url||'';
document.getElementById('filename').value=state.filename||'';
log('State loaded from storage','success');
alert('State loaded!');
}else{
alert('No saved state found');
}
};

const exportHistory=()=>{
const history=localStorage.getItem('downloadHistory')||'[]';
const blob=new Blob([history],{type:'application/json'});
const link=document.createElement('a');
link.href=URL.createObjectURL(blob);
link.download=`download-history-${Date.now()}.json`;
link.click();
URL.revokeObjectURL(link.href);
log('History exported','success');
};

const clearDebug=()=>{
document.getElementById('debug-log').textContent='No debug logs yet...';
log('Debug log cleared');
};

// Initialize
window.onload=()=>{
const theme=localStorage.getItem('theme')||'dark';
if(theme==='light'){
document.body.classList.add('light');
document.getElementById('theme-toggle').checked=false;
}
updateHistoryDisplay();
log('File Downloader initialized','success');
log(`Device: ${screen.width<=699?'Mobile':'Desktop'}`);
};
</script>
</body>
</html>