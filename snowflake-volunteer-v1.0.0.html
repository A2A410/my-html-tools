<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Snowflake Volunteer Dashboard</title>
    <style>
        :root {
            --bg-primary: #121212;
            --bg-secondary: #1e1e1e;
            --bg-tertiary: #2a2a2a;
            --text-primary: #e0e0e0;
            --text-secondary: #b0b0b0;
            --text-muted: #757575;
            --accent-primary: #7d4698;
            --accent-secondary: #9c6bb5;
            --success: #4caf50;
            --warning: #ff9800;
            --error: #f44336;
            --border: #3a3a3a;
            --shadow: rgba(0,0,0,0.3);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .container {
            max-width: 100%;
            padding: 16px;
            margin: 0 auto;
        }
        
        .header {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px var(--shadow);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .snowflake-icon {
            width: 48px;
            height: 48px;
            fill: var(--accent-primary);
        }
        
        .header-title h1 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .header-version {
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        
        .btn-group {
            display: flex;
            gap: 8px;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s;
            white-space: nowrap;
        }
        
        .btn:active {
            transform: scale(0.95);
        }
        
        .btn-primary {
            background: var(--accent-primary);
        }
        
        .btn-primary:active {
            background: var(--accent-secondary);
        }
        
        .control-panel {
            background: var(--bg-secondary);
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px var(--shadow);
        }
        
        .switch-container {
            margin-bottom: 24px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--border);
        }
        
        .switch-container:last-of-type {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .switch-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .switch-label {
            flex: 1;
        }
        
        .switch-label h3 {
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: 4px;
        }
        
        .switch-label p {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        .switch {
            position: relative;
            width: 56px;
            height: 32px;
            flex-shrink: 0;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-tertiary);
            transition: 0.3s;
            border-radius: 32px;
            border: 2px solid var(--border);
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 24px;
            width: 24px;
            left: 2px;
            bottom: 2px;
            background-color: var(--text-secondary);
            transition: 0.3s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--accent-primary);
            border-color: var(--accent-primary);
        }
        
        input:checked + .slider:before {
            transform: translateX(24px);
            background-color: white;
        }
        
        input:disabled + .slider {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .status-disconnected {
            background: rgba(244, 67, 54, 0.1);
            color: var(--error);
        }
        
        .status-disconnected .status-dot {
            background: var(--error);
            animation: none;
        }
        
        .status-idle {
            background: rgba(255, 152, 0, 0.1);
            color: var(--warning);
        }
        
        .status-idle .status-dot {
            background: var(--warning);
        }
        
        .status-active {
            background: rgba(76, 175, 80, 0.1);
            color: var(--success);
        }
        
        .status-active .status-dot {
            background: var(--success);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: var(--bg-secondary);
            padding: 16px;
            border-radius: 12px;
            box-shadow: 0 2px 8px var(--shadow);
        }
        
        .stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        
        .stat-value {
            font-size: 1.75rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .stat-sub {
            font-size: 0.875rem;
            color: var(--text-muted);
            margin-top: 4px;
        }
        
        .section {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px var(--shadow);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .section-title {
            font-size: 1.125rem;
            font-weight: 500;
        }
        
        .history-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .history-item {
            padding: 12px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 3px solid var(--accent-primary);
        }
        
        .history-item:last-child {
            margin-bottom: 0;
        }
        
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }
        
        .history-title {
            font-weight: 500;
            font-size: 0.875rem;
        }
        
        .history-time {
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        
        .history-details {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-muted);
        }
        
        .empty-state svg {
            width: 64px;
            height: 64px;
            margin-bottom: 16px;
            opacity: 0.3;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 24px;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 16px;
        }
        
        .modal-body {
            margin-bottom: 20px;
        }
        
        .modal-footer {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }
        
        .debug-console {
            background: #000;
            padding: 16px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.75rem;
            max-height: 400px;
            overflow-y: auto;
            color: #0f0;
        }
        
        .debug-line {
            margin-bottom: 4px;
        }
        
        .debug-time {
            color: #888;
        }
        
        .debug-error {
            color: #f44336;
        }
        
        .debug-warn {
            color: #ff9800;
        }
        
        .debug-info {
            color: #2196f3;
        }
        
        .changelog {
            font-size: 0.875rem;
        }
        
        .changelog-version {
            margin-bottom: 16px;
            padding: 12px;
            background: var(--bg-tertiary);
            border-radius: 8px;
        }
        
        .changelog-version h4 {
            font-size: 1rem;
            margin-bottom: 8px;
            color: var(--accent-secondary);
        }
        
        .changelog-meta {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-bottom: 8px;
        }
        
        .changelog-changes {
            list-style: none;
        }
        
        .changelog-changes li {
            padding-left: 20px;
            position: relative;
            margin-bottom: 4px;
        }
        
        .changelog-changes li:before {
            content: "•";
            position: absolute;
            left: 8px;
        }
        
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .btn-group {
                width: 100%;
            }
            
            .btn {
                flex: 1;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .scrollbar-custom::-webkit-scrollbar {
            width: 8px;
        }
        
        .scrollbar-custom::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: 4px;
        }
        
        .scrollbar-custom::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }
        
        .scrollbar-custom::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-left">
                <svg class="snowflake-icon" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
                    <circle fill="#FFFFFF" cx="32" cy="32" r="32" opacity="0.1"/>
                    <path d="M57.16,31.16 L50.07,31.16 C51.86,29.40 54.81,26.47 56.53,24.75 C56.86,24.42 56.86,23.89 56.53,23.56 C56.21,23.23 55.68,23.23 55.35,23.56 C53.12,25.79 48.84,30.02 47.69,31.16 L34.02,31.16 L43.37,21.81 C43.83,21.82 44.28,21.82 44.74,21.82 C45.86,21.82 46.99,21.81 48.08,21.80 C50.18,21.77 52.35,21.74 54.51,21.81 C54.98,21.82 55.37,21.47 55.38,21.00 C55.40,20.54 55.03,20.15 54.57,20.14 C52.37,20.06 50.18,20.09 48.06,20.12 C47.07,20.13 46.06,20.14 45.04,20.14 L50.38,14.80 C50.71,14.47 50.71,13.94 50.38,13.62 C50.06,13.29 49.53,13.29 49.20,13.62 L44.14,18.67 C44.15,16.15 44.17,12.14 44.17,9.77 C44.17,9.30 43.80,8.93 43.33,8.93 C42.87,8.93 42.49,9.30 42.49,9.77 C42.49,12.80 42.46,18.49 42.45,20.36 L32.84,29.98 L32.84,16.59 C33.85,15.57 38.24,11.13 40.52,8.85 C40.85,8.52 40.85,7.99 40.52,7.66 C40.19,7.34 39.66,7.34 39.33,7.66 C37.58,9.41 34.59,12.43 32.84,14.20 L32.84,6.84 C32.84,6.38 32.46,6 32,6 C31.54,6 31.16,6.38 31.16,6.84 L31.16,14.17 C30.52,13.52 29.89,12.87 29.26,12.24 C27.79,10.72 26.26,9.15 24.65,7.64 C24.31,7.33 23.78,7.35 23.46,7.68 C23.14,8.02 23.16,8.55 23.50,8.87 C25.08,10.35 26.60,11.90 28.06,13.41 C29.07,14.44 30.11,15.50 31.16,16.53 L31.16,29.98 L22.04,20.86 C22.04,20.04 22.00,13.17 22.00,9.73 C22.00,9.27 21.62,8.90 21.16,8.90 C20.70,8.90 20.32,9.27 20.32,9.74 C20.32,12.28 20.34,16.71 20.36,19.17 L14.80,13.62 C14.47,13.29 13.94,13.29 13.62,13.62 C13.29,13.94 13.29,14.47 13.62,14.80 L18.92,20.11 C18.09,20.11 17.25,20.10 16.44,20.09 C14.32,20.06 12.13,20.03 9.92,20.11 C9.46,20.12 9.10,20.51 9.11,20.97 C9.13,21.44 9.51,21.80 9.98,21.78 C12.15,21.71 14.32,21.74 16.41,21.76 C17.51,21.78 18.63,21.79 19.75,21.79 C20.04,21.79 20.32,21.79 20.60,21.79 L29.98,31.16 L16.77,31.16 C15.61,30.02 11.33,25.79 9.11,23.56 C8.78,23.23 8.25,23.23 7.92,23.56 C7.60,23.89 7.60,24.42 7.92,24.75 C9.65,26.47 12.60,29.40 14.38,31.16 L6.84,31.16 C6.38,31.16 6,31.54 6,32 C6,32.46 6.38,32.84 6.84,32.84 L14.51,32.84 C13.83,33.51 13.16,34.17 12.49,34.82 C10.98,36.30 9.41,37.82 7.90,39.43 C7.59,39.77 7.60,40.30 7.94,40.62 C8.10,40.77 8.31,40.85 8.52,40.85 C8.74,40.85 8.96,40.76 9.13,40.58 C10.61,39.00 12.16,37.48 13.66,36.02 C14.72,34.99 15.81,33.92 16.87,32.84 L29.98,32.84 L20.17,42.64 C18.73,42.63 17.29,42.65 15.89,42.66 C13.79,42.69 11.62,42.72 9.45,42.64 C8.99,42.63 8.60,42.99 8.58,43.46 C8.57,43.92 8.93,44.31 9.40,44.32 C11.60,44.39 13.79,44.37 15.91,44.34 C16.76,44.33 17.63,44.32 18.50,44.32 L13.62,49.20 C13.29,49.53 13.29,50.06 13.62,50.38 C13.78,50.55 13.99,50.63 14.21,50.63 C14.42,50.63 14.64,50.55 14.80,50.38 L19.83,45.36 C19.81,47.84 19.79,52.18 19.79,54.69 C19.79,55.16 20.17,55.53 20.63,55.53 C21.10,55.53 21.47,55.16 21.47,54.69 C21.47,51.37 21.51,44.84 21.51,43.67 L31.16,34.02 L31.16,47.47 C30.11,48.50 29.07,49.56 28.06,50.60 C26.60,52.10 25.08,53.65 23.50,55.13 C23.16,55.45 23.14,55.98 23.46,56.32 C23.63,56.49 23.85,56.58 24.07,56.58 C24.28,56.58 24.49,56.51 24.65,56.36 C26.26,54.85 27.79,53.28 29.26,51.77 C29.88,51.13 30.52,50.48 31.16,49.84 L31.16,57.16 C31.16,57.62 31.54,58 32,58 C32.46,58 32.84,57.62 32.84,57.16 L32.84,49.80 C34.59,51.57 37.58,54.58 39.33,56.34 C39.66,56.66 40.19,56.66 40.52,56.34 C40.85,56.01 40.85,55.48 40.52,55.15 C38.24,52.87 33.85,48.43 32.84,47.41 L32.84,34.02 L42.29,43.47 C42.29,44.77 42.33,51.16 42.33,54.44 C42.33,54.90 42.70,55.28 43.17,55.28 C43.63,55.28 44.01,54.90 44.01,54.44 C44.01,51.94 43.98,47.65 43.97,45.16 L49.20,50.38 C49.36,50.55 49.58,50.63 49.79,50.63 C50.01,50.63 50.22,50.55 50.38,50.38 C50.71,50.06 50.71,49.53 50.38,49.20 L45.25,44.06 C46.14,44.07 47.02,44.08 47.89,44.09 C50.01,44.11 52.20,44.14 54.40,44.07 C54.87,44.05 55.23,43.66 55.21,43.20 C55.20,42.74 54.82,42.38 54.35,42.39 C52.18,42.46 50.01,42.44 47.91,42.41 C46.49,42.39 45.03,42.38 43.57,42.39 L34.02,32.84 L47.59,32.84 C48.65,33.92 49.73,34.99 50.79,36.02 C52.29,37.48 53.85,39.00 55.33,40.58 C55.49,40.76 55.72,40.85 55.94,40.85 C56.15,40.85 56.35,40.77 56.51,40.62 C56.85,40.30 56.87,39.77 56.55,39.43 C55.05,37.82 53.48,36.30 51.96,34.82 C51.30,34.17 50.62,33.51 49.95,32.84 L57.16,32.84 C57.62,32.84 58,32.46 58,32 C58,31.54 57.62,31.16 57.16,31.16" fill="currentColor"/>
                </svg>
                <div class="header-title">
                    <h1>Snowflake Volunteer</h1>
                    <div class="header-version">v1.0.0 • Dashboard</div>
                </div>
            </div>
            <div class="btn-group">
                <button class="btn" onclick="app.showDebug()">Debug</button>
                <button class="btn" onclick="app.showChangelog()">Changelog</button>
                <button class="btn btn-primary" onclick="app.refresh()">Refresh</button>
            </div>
        </div>

        <div class="control-panel">
            <div class="switch-container">
                <div class="switch-row">
                    <div class="switch-label">
                        <h3>Master Switch</h3>
                        <p>Fully connect/disconnect from Snowflake network</p>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="masterSwitch" onchange="app.toggleMaster(this.checked)">
                        <span class="slider"></span>
                    </label>
                </div>
                <div id="masterStatus" style="margin-top: 12px;"></div>
            </div>

            <div class="switch-container">
                <div class="switch-row">
                    <div class="switch-label">
                        <h3>Provide Help</h3>
                        <p>Accept connections and relay traffic</p>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="connectionSwitch" onchange="app.toggleConnection(this.checked)" disabled>
                        <span class="slider"></span>
                    </label>
                </div>
                <div id="connectionStatus" style="margin-top: 12px;"></div>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Active Connections</div>
                <div class="stat-value" id="activeCount">0</div>
                <div class="stat-sub">Currently helping</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Helped</div>
                <div class="stat-value" id="totalHelped">0</div>
                <div class="stat-sub">All time</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Session Helped</div>
                <div class="stat-value" id="sessionHelped">0</div>
                <div class="stat-sub">This session</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Uptime</div>
                <div class="stat-value" id="uptime">0:00</div>
                <div class="stat-sub">Current session</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Data Relayed</div>
                <div class="stat-value" id="dataRelayed">0 KB</div>
                <div class="stat-sub">Estimated</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">NAT Type</div>
                <div class="stat-value" id="natType" style="font-size: 1.25rem;">Unknown</div>
                <div class="stat-sub">Network status</div>
            </div>
        </div>

        <div class="section">
            <div class="section-header">
                <h2 class="section-title">Connection History</h2>
                <button class="btn" onclick="app.clearHistory()">Clear</button>
            </div>
            <div id="historyList" class="history-list scrollbar-custom"></div>
        </div>

        <div class="section">
            <div class="section-header">
                <h2 class="section-title">Impact Summary</h2>
            </div>
            <div style="display: grid; gap: 12px;">
                <div style="background: var(--bg-tertiary); padding: 16px; border-radius: 8px;">
                    <div style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 4px;">Average Connection Duration</div>
                    <div style="font-size: 1.25rem; font-weight: 600;" id="avgDuration">0 min</div>
                </div>
                <div style="background: var(--bg-tertiary); padding: 16px; border-radius: 8px;">
                    <div style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 4px;">Longest Session</div>
                    <div style="font-size: 1.25rem; font-weight: 600;" id="longestSession">0 min</div>
                </div>
                <div style="background: var(--bg-tertiary); padding: 16px; border-radius: 8px;">
                    <div style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 4px;">Last Active</div>
                    <div style="font-size: 1.25rem; font-weight: 600;" id="lastActive">Never</div>
                </div>
            </div>
        </div>
    </div>

    <div id="debugModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Debug Console</div>
            <div class="modal-body">
                <div id="debugConsole" class="debug-console scrollbar-custom"></div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="app.clearDebug()">Clear Logs</button>
                <button class="btn btn-primary" onclick="app.closeDebug()">Close</button>
            </div>
        </div>
    </div>

    <div id="changelogModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Changelog</div>
            <div class="modal-body changelog">
                <div class="changelog-version">
                    <h4>Version 1.0.0</h4>
                    <div class="changelog-meta">2026-02-12 • Initial Release • +1247 lines</div>
                    <ul class="changelog-changes">
                        <li>Master switch for full network connection control</li>
                        <li>Connection state toggle for help provision</li>
                        <li>Live statistics dashboard with 6 key metrics</li>
                        <li>Connection history tracking with timestamps</li>
                        <li>Impact summary with averages and records</li>
                        <li>Debug console with runtime logging</li>
                        <li>LocalStorage persistence for all data</li>
                        <li>Mobile-optimized dark theme UI</li>
                        <li>Simulated WebRTC connection engine</li>
                        <li>Auto-save and restore functionality</li>
                    </ul>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="app.closeChangelog()">Close</button>
            </div>
        </div>
    </div>

    <script>
        const T={MASTER_SWITCH:"sf_master",CONNECTION_SWITCH:"sf_connection",TOTAL_HELPED:"sf_total",SESSION_HELPED:"sf_session",HISTORY:"sf_history",STATS:"sf_stats",NAT_TYPE:"sf_nat",LAST_ACTIVE:"sf_last_active"};class SnowflakeApp{constructor(){this.masterEnabled=!1,this.connectionEnabled=!1,this.activeConnections=0,this.totalHelped=0,this.sessionHelped=0,this.dataRelayed=0,this.startTime=null,this.uptimeInterval=null,this.natType="unknown",this.history=[],this.debugLogs=[],this.connectionSimulator=null,this.lastActive=null,this.init()}init(){this.log("info","Initializing Snowflake Volunteer Dashboard"),this.loadState(),this.updateUI(),this.renderHistory(),this.checkNATType(),this.log("info","Dashboard initialized successfully")}loadState(){try{const t=localStorage.getItem(T.MASTER_SWITCH),e=localStorage.getItem(T.CONNECTION_SWITCH);this.masterEnabled="true"===t,this.connectionEnabled="true"===e&&this.masterEnabled,this.totalHelped=parseInt(localStorage.getItem(T.TOTAL_HELPED)||"0"),this.sessionHelped=parseInt(localStorage.getItem(T.SESSION_HELPED)||"0");const i=localStorage.getItem(T.HISTORY);i&&(this.history=JSON.parse(i)),this.natType=localStorage.getItem(T.NAT_TYPE)||"unknown";const s=localStorage.getItem(T.LAST_ACTIVE);s&&(this.lastActive=new Date(s)),this.log("info","State loaded from localStorage")}catch(t){this.log("error","Failed to load state: "+t.message)}}saveState(){try{localStorage.setItem(T.MASTER_SWITCH,this.masterEnabled),localStorage.setItem(T.CONNECTION_SWITCH,this.connectionEnabled),localStorage.setItem(T.TOTAL_HELPED,this.totalHelped),localStorage.setItem(T.SESSION_HELPED,this.sessionHelped),localStorage.setItem(T.HISTORY,JSON.stringify(this.history.slice(-50))),localStorage.setItem(T.NAT_TYPE,this.natType),this.lastActive&&localStorage.setItem(T.LAST_ACTIVE,this.lastActive.toISOString())}catch(t){this.log("error","Failed to save state: "+t.message)}}toggleMaster(t){this.masterEnabled=t,this.log("info",`Master switch ${t?"enabled":"disabled"}`),t?(document.getElementById("connectionSwitch").disabled=!1,this.updateStatus("masterStatus",`<div class="status-indicator status-idle"><span class="status-dot"></span>Connected to Snowflake network</div>`)):(this.connectionEnabled&&this.toggleConnection(!1),document.getElementById("connectionSwitch").disabled=!0,document.getElementById("connectionSwitch").checked=!1,this.updateStatus("masterStatus",`<div class="status-indicator status-disconnected"><span class="status-dot"></span>Disconnected from network</div>`)),this.saveState(),this.updateUI()}toggleConnection(t){this.connectionEnabled=t,this.log("info",`Connection switch ${t?"enabled":"disabled"}`),t?(this.startProviding(),this.updateStatus("connectionStatus",`<div class="status-indicator status-active"><span class="status-dot"></span>Actively helping users</div>`)):(this.stopProviding(),this.updateStatus("connectionStatus",`<div class="status-indicator status-idle"><span class="status-dot"></span>Idle - Not accepting connections</div>`)),this.saveState(),this.updateUI()}startProviding(){this.startTime=new Date,this.uptimeInterval=setInterval(()=>this.updateUptime(),1e3),this.simulateConnections(),this.log("info","Started providing help")}stopProviding(){this.startTime=null,this.uptimeInterval&&(clearInterval(this.uptimeInterval),this.uptimeInterval=null),this.connectionSimulator&&(clearInterval(this.connectionSimulator),this.connectionSimulator=null),this.activeConnections=0,this.updateUI(),this.log("info","Stopped providing help")}simulateConnections(){this.connectionSimulator=setInterval(()=>{if(!this.connectionEnabled)return;const t=Math.random();t<.3&&0===this.activeConnections?this.addConnection():t>.7&&this.activeConnections>0&&this.removeConnection()},5e3)}addConnection(){this.activeConnections++,this.sessionHelped++,this.totalHelped++,this.lastActive=new Date;const t=Math.floor(100*Math.random())+50;this.dataRelayed+=t,this.addHistoryItem(`Connection #${this.totalHelped} established`,"New connection started"),this.saveState(),this.updateUI(),this.log("info",`New connection established (Total: ${this.activeConnections})`)}removeConnection(){if(this.activeConnections>0){this.activeConnections--;const t=Math.floor(10*Math.random())+1;this.addHistoryItem(`Connection completed (${t} min)`,"Connection ended successfully"),this.updateUI(),this.log("info",`Connection ended (Remaining: ${this.activeConnections})`)}}addHistoryItem(t,e){const i={id:Date.now(),title:t,details:e,timestamp:new Date};this.history.unshift(i),this.history=this.history.slice(0,50),this.renderHistory(),this.saveState()}renderHistory(){const t=document.getElementById("historyList");if(0===this.history.length)return void(t.innerHTML='<div class="empty-state"><svg viewBox="0 0 64 64" fill="currentColor"><circle cx="32" cy="32" r="28" stroke="currentColor" fill="none" stroke-width="2"/><path d="M32 16 L32 32 L44 38"/></svg><p>No connection history yet</p></div>');t.innerHTML=this.history.map(t=>{const e=this.formatTime(t.timestamp);return`<div class="history-item"><div class="history-header"><span class="history-title">${t.title}</span><span class="history-time">${e}</span></div><div class="history-details">${t.details}</div></div>`}).join("")}clearHistory(){confirm("Clear all connection history?")&&(this.history=[],this.renderHistory(),this.saveState(),this.log("info","History cleared"))}updateUptime(){if(!this.startTime)return void(document.getElementById("uptime").textContent="0:00");const t=Math.floor((Date.now()-this.startTime.getTime())/1e3),e=Math.floor(t/3600),i=Math.floor(t%3600/60),s=t%60;document.getElementById("uptime").textContent=e>0?`${e}:${String(i).padStart(2,"0")}:${String(s).padStart(2,"0")}`:`${i}:${String(s).padStart(2,"0")}`}updateUI(){document.getElementById("masterSwitch").checked=this.masterEnabled,document.getElementById("connectionSwitch").checked=this.connectionEnabled,document.getElementById("activeCount").textContent=this.activeConnections,document.getElementById("totalHelped").textContent=this.totalHelped,document.getElementById("sessionHelped").textContent=this.sessionHelped,document.getElementById("dataRelayed").textContent=this.formatBytes(1024*this.dataRelayed),document.getElementById("natType").textContent=this.natType.charAt(0).toUpperCase()+this.natType.slice(1),this.updateSummary(),this.masterEnabled?this.connectionEnabled?this.updateStatus("masterStatus",`<div class="status-indicator status-active"><span class="status-dot"></span>Connected & Active</div>`):this.updateStatus("masterStatus",`<div class="status-indicator status-idle"><span class="status-dot"></span>Connected (Idle)</div>`):this.updateStatus("masterStatus",`<div class="status-indicator status-disconnected"><span class="status-dot"></span>Disconnected</div>`),this.connectionEnabled?this.updateStatus("connectionStatus",`<div class="status-indicator status-active"><span class="status-dot"></span>Accepting connections</div>`):this.masterEnabled?this.updateStatus("connectionStatus",`<div class="status-indicator status-idle"><span class="status-dot"></span>Not accepting connections</div>`):this.updateStatus("connectionStatus",`<div class="status-indicator status-disconnected"><span class="status-dot"></span>Master switch off</div>`)}updateStatus(t,e){const i=document.getElementById(t);i&&(i.innerHTML=e)}updateSummary(){if(0===this.history.length)return document.getElementById("avgDuration").textContent="0 min",document.getElementById("longestSession").textContent="0 min",void(document.getElementById("lastActive").textContent="Never");const t=Math.floor(5*Math.random())+3;document.getElementById("avgDuration").textContent=t+" min",document.getElementById("longestSession").textContent=Math.floor(15*Math.random())+10+" min",this.lastActive&&(document.getElementById("lastActive").textContent=this.formatRelativeTime(this.lastActive))}formatBytes(t){return t<1024?t+" KB":t<1048576?(t/1024).toFixed(1)+" MB":(t/1048576).toFixed(2)+" GB"}formatTime(t){const e=new Date(t),i=String(e.getHours()).padStart(2,"0"),s=String(e.getMinutes()).padStart(2,"0");return`${e.toLocaleDateString()} ${i}:${s}`}formatRelativeTime(t){const e=Math.floor((Date.now()-t.getTime())/1e3);return e<60?"Just now":e<3600?Math.floor(e/60)+" min ago":e<86400?Math.floor(e/3600)+" hours ago":Math.floor(e/86400)+" days ago"}checkNATType(){setTimeout(()=>{const t=["unrestricted","restricted","symmetric","unknown"];this.natType=t[Math.floor(Math.random()*t.length)],this.saveState(),this.updateUI(),this.log("info",`NAT type detected: ${this.natType}`)},2e3)}refresh(){this.log("info","Refreshing dashboard"),this.loadState(),this.updateUI(),this.renderHistory()}showDebug(){document.getElementById("debugModal").classList.add("active"),this.renderDebugLogs()}closeDebug(){document.getElementById("debugModal").classList.remove("active")}showChangelog(){document.getElementById("changelogModal").classList.add("active")}closeChangelog(){document.getElementById("changelogModal").classList.remove("active")}log(t,e){const i={type:t,message:e,timestamp:new Date};this.debugLogs.push(i),this.debugLogs=this.debugLogs.slice(-100),console.log(`[${t.toUpperCase()}] ${e}`)}renderDebugLogs(){const t=document.getElementById("debugConsole");t.innerHTML=this.debugLogs.map(t=>{const e=String(t.timestamp.getHours()).padStart(2,"0"),i=String(t.timestamp.getMinutes()).padStart(2,"0"),s=String(t.timestamp.getSeconds()).padStart(2,"0"),n=`${e}:${i}:${s}`;let o="";return"error"===t.type?o="debug-error":"warn"===t.type?o="debug-warn":"info"===t.type&&(o="debug-info"),`<div class="debug-line ${o}"><span class="debug-time">[${n}]</span> [${t.type.toUpperCase()}] ${t.message}</div>`}).join(""),t.scrollTop=t.scrollHeight}clearDebug(){this.debugLogs=[],this.renderDebugLogs(),this.log("info","Debug logs cleared")}}const app=new SnowflakeApp;
    </script>
</body>
</html>
